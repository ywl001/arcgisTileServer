<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <title>ç»Ÿä¸€åˆ‡ç‰‡æœåŠ¡æµ‹è¯• (æŒ‰é’®åˆ‡æ¢)</title>
    
    <link rel="stylesheet" href="https://js.arcgis.com/4.29/esri/themes/light/main.css" />
    <script src="https://js.arcgis.com/4.29/"></script>

    <style>
        html, body, #viewDiv {
            padding: 0;
            margin: 0;
            height: 100%;
            width: 100%;
        }
        /* æ ·å¼ï¼šç”¨äºæ”¾ç½®åˆ‡æ¢æŒ‰é’® */
        #buttonContainer {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 10;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            display: flex;
            gap: 10px;
        }
        .toggle-button {
            padding: 8px 15px;
            cursor: pointer;
            border: 1px solid #ccc;
            border-radius: 3px;
            background-color: #f8f8f8;
            transition: background-color 0.2s;
        }
        .toggle-button.active {
            background-color: #0079c1;
            color: white;
            border-color: #0079c1;
        }
    </style>
</head>
<body>
    <div id="viewDiv"></div>
    
    <div id="buttonContainer">
        <div id="btnRaster" class="toggle-button active">æ …æ ¼å½±åƒ (MJ)</div>
        <div id="btnVector" class="toggle-button">çŸ¢é‡åº•å›¾ (å­Ÿæ´¥)</div>
    </div>

    <script>
        require([
            "esri/Map",
            "esri/views/MapView",
            "esri/layers/TileLayer",
            "esri/layers/VectorTileLayer",
            "esri/Basemap", // ğŸŒŸ å¼•å…¥ Basemap æ¨¡å—
            "esri/geometry/Extent",
            "esri/geometry/SpatialReference"
        ], (Map, MapView, TileLayer, VectorTileLayer, Basemap, Extent, SpatialReference) => {

            const spatialReference = new SpatialReference({ wkid: 4326 });
            
            const mjExtent = new Extent({
                xmin: 112.0, ymin: 34.6, xmax: 112.9, ymax: 35.1, spatialReference: spatialReference
            });

            // ----------------------------------------------------
            // 1. å®šä¹‰å›¾å±‚ï¼ˆæ³¨æ„ï¼šå®ƒä»¬å°†ä½œä¸º Basemap çš„åŸºç¡€å›¾å±‚ï¼‰
            // ----------------------------------------------------
            
            // æ …æ ¼åˆ‡ç‰‡
            const rasterLayer = new TileLayer({
                url: "http://localhost:3060/image_tiles/mj_19/MapServer", 
                title: "æ …æ ¼å½±åƒ (MJ)", 
                id: "raster_mj",
                visible: true // é»˜è®¤å¯è§
            });

            // çŸ¢é‡åˆ‡ç‰‡
            const vectorLayer = new VectorTileLayer({
                url: "http://localhost:3060/vector_tiles/mengjin/p12", 
                title: "çŸ¢é‡åº•å›¾ (å­Ÿæ´¥)", 
                id: "vector_mengjin",
                visible: false // é»˜è®¤ä¸å¯è§ï¼Œè®©æ …æ ¼å›¾å±‚å…ˆæ˜¾ç¤º
            });
            
            // ----------------------------------------------------
            // 2. åˆ›å»º Map, å¹¶å°†æ‰€æœ‰å›¾å±‚æ·»åŠ åˆ° Basemap çš„ baseLayers
            // ----------------------------------------------------
            
            const map = new Map({
                // åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„åº•å›¾ï¼Œå¹¶å°†ä¸¤ä¸ªå›¾å±‚éƒ½åŠ å…¥
                basemap: new Basemap({
                    baseLayers: [rasterLayer, vectorLayer],
                    title: "è‡ªå®šä¹‰åº•å›¾ç»„"
                })
            });

            const view = new MapView({
                container: "viewDiv",
                map: map,
                extent: mjExtent, 
                zoom: 12 
            });

            // ----------------------------------------------------
            // 3. åˆ‡æ¢å›¾å±‚é€»è¾‘
            // ----------------------------------------------------
            const btnRaster = document.getElementById("btnRaster");
            const btnVector = document.getElementById("btnVector");

            function setActiveLayer(activeId) {
                // éå† Map ä¸­ Basemap çš„æ‰€æœ‰åŸºç¡€å›¾å±‚
                map.basemap.baseLayers.forEach(layer => {
                    if (layer.id === activeId) {
                        layer.visible = true;
                    } else {
                        layer.visible = false;
                    }
                });

                // æ›´æ–°æŒ‰é’®æ ·å¼
                btnRaster.classList.remove("active");
                btnVector.classList.remove("active");
                
                if (activeId === "raster_mj") {
                    btnRaster.classList.add("active");
                } else if (activeId === "vector_mengjin") {
                    btnVector.classList.add("active");
                }
            }

            // ç»‘å®šç‚¹å‡»äº‹ä»¶
            btnRaster.addEventListener("click", () => setActiveLayer("raster_mj"));
            btnVector.addEventListener("click", () => setActiveLayer("vector_mengjin"));

            view.when(() => {
                console.log("åœ°å›¾è§†å›¾åŠ è½½å®Œæˆï¼Œç°åœ¨å¯ä»¥é€šè¿‡æŒ‰é’®åˆ‡æ¢åº•å›¾ã€‚");
                
                // ç¡®ä¿åˆå§‹çŠ¶æ€æ­£ç¡®ï¼šåªæœ‰æ …æ ¼å›¾å±‚å¯è§
                setActiveLayer("raster_mj");
            });
        });
    </script>
</body>
</html>