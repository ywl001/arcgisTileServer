<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <title>ç»Ÿä¸€åˆ‡ç‰‡æœåŠ¡æµ‹è¯• (æ …æ ¼ + çŸ¢é‡ + LayerList)</title>
    
    <link rel="stylesheet" href="https://js.arcgis.com/4.29/esri/themes/light/main.css" />
    <script src="https://js.arcgis.com/4.29/"></script>

    <style>
        html, body, #viewDiv {
            padding: 0;
            margin: 0;
            height: 100%;
            width: 100%;
        }
        /* è°ƒæ•´ LayerList çš„ä½ç½® */
        .esri-layer-list {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 50; /* ç¡®ä¿å®ƒåœ¨åœ°å›¾ä¹‹ä¸Š */
        }
    </style>
</head>
<body>
    <div id="viewDiv"></div>

    <script>
        require([
            "esri/Map",
            "esri/views/MapView",
            "esri/layers/TileLayer",
            "esri/layers/VectorTileLayer",
            "esri/widgets/LayerList",  // ğŸŒŸ å¼•å…¥ LayerList æ§ä»¶
            "esri/geometry/Extent",
            "esri/geometry/SpatialReference"
        ], (Map, MapView, TileLayer, VectorTileLayer, LayerList, Extent, SpatialReference) => {

            const spatialReference = new SpatialReference({ wkid: 4326 });
            
            // å­Ÿæ´¥å¿åŒºå¤§è‡´èŒƒå›´ï¼Œç”¨äºå¯¼èˆª (WKID 4326)
            const mjExtent = new Extent({
                xmin: 112.1,
                ymin: 34.6,
                xmax: 112.8,
                ymax: 35.1,
                spatialReference: spatialReference
            });

            // 1. æ …æ ¼åˆ‡ç‰‡
            const rasterLayer = new TileLayer({
                url: "http://localhost:3060/image_tiles/tianditu/MapServer", 
                title: "æ …æ ¼åº•å›¾ (MJ å½±åƒ)", // LayerList å°†æ˜¾ç¤ºè¿™ä¸ªæ ‡é¢˜
                id: "raster_mj",
                visible: true // é»˜è®¤å¯è§
            });

            // 2. çŸ¢é‡åˆ‡ç‰‡
            const vectorLayer = new VectorTileLayer({
                url: "http://localhost:3060/vector_tiles/test/p12", 
                title: "çŸ¢é‡å åŠ  (å­Ÿæ´¥)", // LayerList å°†æ˜¾ç¤ºè¿™ä¸ªæ ‡é¢˜
                id: "vector_mengjin",
                opacity: 0.8,
                visible: true // é»˜è®¤å¯è§
            });


            // 3. åˆ›å»º Map å’Œ MapView
            const map = new Map({
                layers: [rasterLayer, vectorLayer] 
            });

            const view = new MapView({
                container: "viewDiv",
                map: map,
                extent: mjExtent, 
                zoom: 12 
            });

            view.when(() => {
                console.log("åœ°å›¾è§†å›¾åŠ è½½å®Œæˆï¼Œæ­£åœ¨æ·»åŠ å›¾å±‚åˆ—è¡¨æ§ä»¶...");
                
                // 4. æ·»åŠ  LayerList æ§ä»¶
                const layerList = new LayerList({
                    view: view,
                    // å¯ä»¥è‡ªå®šä¹‰åˆ—è¡¨é¡¹çš„åˆ›å»ºå‡½æ•°ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨é»˜è®¤å³å¯
                    // listItemCreatedFunction: function(event) { ... }
                });

                // å°† LayerList æ§ä»¶æ·»åŠ åˆ°è§†å›¾çš„å³ä¸Šè§’
                view.ui.add(layerList, "top-right");

            });
        });
    </script>
</body>
</html>