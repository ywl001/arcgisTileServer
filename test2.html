<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <title>统一切片服务测试 (栅格 + 矢量 + LayerList)</title>
    
    <link rel="stylesheet" href="https://js.arcgis.com/4.29/esri/themes/light/main.css" />
    <script src="https://js.arcgis.com/4.29/"></script>

    <style>
        html, body, #viewDiv {
            padding: 0;
            margin: 0;
            height: 100%;
            width: 100%;
        }
        /* 调整 LayerList 的位置 */
        .esri-layer-list {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 50; /* 确保它在地图之上 */
        }
    </style>
</head>
<body>
    <div id="viewDiv"></div>

    <script>
        require([
            "esri/Map",
            "esri/views/MapView",
            "esri/layers/TileLayer",
            "esri/layers/VectorTileLayer",
            "esri/widgets/LayerList",  // 🌟 引入 LayerList 控件
            "esri/geometry/Extent",
            "esri/geometry/SpatialReference"
        ], (Map, MapView, TileLayer, VectorTileLayer, LayerList, Extent, SpatialReference) => {

            const spatialReference = new SpatialReference({ wkid: 4326 });
            
            // 孟津县区大致范围，用于导航 (WKID 4326)
            const mjExtent = new Extent({
                xmin: 112.1,
                ymin: 34.6,
                xmax: 112.8,
                ymax: 35.1,
                spatialReference: spatialReference
            });

            // 1. 栅格切片
            const rasterLayer = new TileLayer({
                url: "http://localhost:3060/image_tiles/tianditu/MapServer", 
                title: "栅格底图 (MJ 影像)", // LayerList 将显示这个标题
                id: "raster_mj",
                visible: true // 默认可见
            });

            // 2. 矢量切片
            const vectorLayer = new VectorTileLayer({
                url: "http://localhost:3060/vector_tiles/test/p12", 
                title: "矢量叠加 (孟津)", // LayerList 将显示这个标题
                id: "vector_mengjin",
                opacity: 0.8,
                visible: true // 默认可见
            });


            // 3. 创建 Map 和 MapView
            const map = new Map({
                layers: [rasterLayer, vectorLayer] 
            });

            const view = new MapView({
                container: "viewDiv",
                map: map,
                extent: mjExtent, 
                zoom: 12 
            });

            view.when(() => {
                console.log("地图视图加载完成，正在添加图层列表控件...");
                
                // 4. 添加 LayerList 控件
                const layerList = new LayerList({
                    view: view,
                    // 可以自定义列表项的创建函数，这里我们使用默认即可
                    // listItemCreatedFunction: function(event) { ... }
                });

                // 将 LayerList 控件添加到视图的右上角
                view.ui.add(layerList, "top-right");

            });
        });
    </script>
</body>
</html>